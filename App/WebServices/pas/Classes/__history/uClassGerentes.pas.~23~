{
 WEB SERVICES Versão 2022.11.0001
+--------------------------------------------------------------------------------------------------------------------------+
 Objeto referente as informações dos gerentes, irá realizar os select, insert e update
 Data Criação........: 13/12/20222
 Autor...............: Hilson Santos
+--------------------------------------------------------------------------------------------------------------------------+
}
unit uClassGerentes;

interface

uses
    System.SysUtils,
    Data.DB,
    Data.Win.ADODB,
    uDWConsts;
type
    TGerentes = class
      private
          FGerenteId: string;
          FRcaId:     string;
          FNome:      string;
      public
          QOracleConsinco,
          QOracleMaxima: TADOQuery;
          QInsertInto: string;
          property GerenteId: string read FGerenteId write FGerenteId;
          property RcaId:     string read FRcaId     write FRcaId;
          property Nome:      string read FNome      write FNome;
          function ListarGerentes(out Erro: string): TADOQuery;
          function CheckGerente(CodGerente: string; out TRequest: TRequestType): TRequestType;
          function InsertGerentes(CoGerente, CoRca, NoGerente: string; out Erro: string): TADOQuery;
          function UpdateGerentes(CoGerente, CoRca, NoGerente: string; out Erro: string): TADOQuery;
      end;

implementation

{ TGerentes }

uses uDmBaseDados;

{ LISTA DOS GERENTES }
{ Essa função lista os gerentes no banco de dados do ERP CONCINCO da tabela "MAD_REPRESENTANTE join MAD_EQUIPE" }
function TGerentes.ListarGerentes(out Erro: string): TADOQuery;
begin
    QOracleConsinco:= TADOQuery.Create(nil);  // Estância o objeto "QOracleConsinco"
    with fDmBaseDados do begin
         try
            with QOracleConsinco do begin
                 Close;
                 Connection:= connConcinco;
                 with SQL do begin
                      Clear;
                      Add(
                          'SELECT ' +
                          '      a.nrorepresentante seqgerente,' +
                          '      a.seqpessoa seqrca,' +
                          '      d.nomerazao nome,' +
                          '      NVL(to_char(a.dtaalteracao,''dd/mm/yyyy''),''01/01/1994'') dtaalteracao ' +
                          'FROM implantacao.mad_representante a ' +
                          'INNER JOIN implantacao.mad_equipe b ON b.nroequipe = a.nroequipe ' +
                          'INNER JOIN implantacao.mad_equipe c ON c.nroequipe = b.nroequipesuperior ' +
                          'INNER JOIN implantacao.ge_pessoa d ON d.seqpessoa = c.seqpessoa ' +
                          'WHERE 1=1 ' +
                          'AND a.seqpessoa not in (1,22401) ' +
                          'AND a.tiprepresentante = ''G'''
                      );
                 end;
                 Prepared:= True;
                 Erro:= '';
                 Result:= QOracleConsinco;
            end;
            except on E: Exception do begin
                 Erro:= 'Erro ao listar gerentes: ' + E.Message;
                 Result:= nil;
            end;
         end;
    end;
end;

{ CHECA O GERENTE }
{ Essa função verificar se já existe o gerente na tabela "MXSGERENTE" na aplicação da MAXIMA }
function TGerentes.CheckGerente(CodGerente: string; out TRequest: TRequestType): TRequestType;
begin
//
end;

{ INSERIR OS GERENTES }
{ Essa função realiza o insert na tabela "MXSGERENTE" da aplicação MAXIMA }
function TGerentes.InsertGerentes(CoGerente, CoRca, NoGerente: string; out Erro: string): TADOQuery;
begin
//
end;

{ ALTERA OS GERENTES }
{ Essa função realiza update na tabela "MXSGERENTE" da aplicação MAXIMA }
function TGerentes.UpdateGerentes(CoGerente, CoRca, NoGerente: string; out Erro: string): TADOQuery;
begin
//
end;

end.
